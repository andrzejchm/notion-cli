---
phase: 07-homebrew-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - homebrew-notion-cli/Formula/notion-cli.rb
  - homebrew-notion-cli/README.md
autonomous: false
requirements:
  - ADV-04

must_haves:
  truths:
    - "User can run `brew tap andrzejchm/notion-cli` and `brew install notion-cli` to get the `notion` binary"
    - "Formula installs from the npm tarball at registry.npmjs.org — no npm global install required"
    - "The `homebrew-notion-cli` GitHub repo exists with a valid Formula directory"
  artifacts:
    - path: "homebrew-notion-cli/Formula/notion-cli.rb"
      provides: "Homebrew formula for notion-cli"
      contains: "class NotionCli"
    - path: "homebrew-notion-cli/README.md"
      provides: "Tap instructions and install command"
  key_links:
    - from: "notion-cli.rb"
      to: "registry.npmjs.org/@andrzejchm/notion-cli tarball"
      via: "url + sha256"
      pattern: "registry.npmjs.org"
    - from: "Formula install block"
      to: "notion binary in bin/"
      via: "bin.install_symlink Dir[libexec/bin/*]"
      pattern: "install_symlink"
---

<objective>
Create the `homebrew-notion-cli` GitHub tap repository with a working Homebrew formula
that installs the `notion` CLI from the published npm tarball.

Purpose: Enable `brew install andrzejchm/notion-cli/notion-cli` as a zero-dependency install path
(no npm required, just Homebrew + Node which brew can provide).
Output: A live GitHub repo at `github.com/andrzejchm/homebrew-notion-cli` with a passing formula.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<interfaces>
<!-- Current npm package info -->
Package: @andrzejchm/notion-cli@0.1.2
Tarball URL: https://registry.npmjs.org/@andrzejchm/notion-cli/-/notion-cli-0.1.2.tgz
SHA256: f36c8ae07b545520c20fe36394ea023541af96c58f975946ce1947d68328f0c8
Binary name: notion (from package.json bin.notion)
License: MIT
Node requirement: >=22.0.0

<!-- Reference formula pattern (oracle.rb from steipete/homebrew-tap) -->
The oracle.rb pattern for npm-based formulae:
```ruby
require "language/node"

class FormulaName < Formula
  desc "description"
  homepage "https://github.com/owner/repo"
  url "https://registry.npmjs.org/pkg/-/pkg-VERSION.tgz"
  sha256 "SHA256_OF_TARBALL"
  license "MIT"

  depends_on "node"

  def install
    system "npm", "install", *std_npm_args
    bin.install_symlink Dir["#{libexec}/bin/*"]
  end

  test do
    assert_match version.to_s, shell_output("#{bin}/notion --version")
  end
end
```

std_npm_args expands to: "-ddd --global --build-from-source --cache=$(brew --cache)/npm_cache --prefix=#{libexec}"
This installs into libexec (private to the formula), then symlinks bin entries into brew's bin/.
</interfaces>
</context>

<tasks>

<task type="checkpoint:human-action">
  <name>Task 1: Create homebrew-notion-cli GitHub repository</name>
  <what-built>Nothing yet — this step creates the tap repo that the formula will live in.</what-built>
  <how-to-verify>
    1. Visit https://github.com/new
    2. Create a new public repository named exactly: `homebrew-notion-cli`
       - Owner: andrzejchm
       - Name: homebrew-notion-cli
       - Visibility: Public
       - Initialize with README: YES (check the box)
       - License: MIT
    3. After creation, confirm the repo URL is: https://github.com/andrzejchm/homebrew-notion-cli
  </how-to-verify>
  <resume-signal>Type "created" when the repo exists at https://github.com/andrzejchm/homebrew-notion-cli</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Write the Homebrew formula and tap README</name>
  <files>
    homebrew-notion-cli/Formula/notion-cli.rb
    homebrew-notion-cli/README.md
  </files>
  <action>
    Clone the newly created homebrew-notion-cli repo into a sibling directory, then create:

    **Step 1 — Clone the tap repo:**
    ```
    cd /Users/andrzejchm/Developer
    git clone git@github.com:andrzejchm/homebrew-notion-cli.git
    cd homebrew-notion-cli
    mkdir Formula
    ```

    **Step 2 — Create Formula/notion-cli.rb:**

    ```ruby
    # typed: false
    # frozen_string_literal: true

    class NotionCli < Formula
      desc "Read Notion pages and databases from the terminal"
      homepage "https://github.com/andrzejchm/notion-cli"
      url "https://registry.npmjs.org/@andrzejchm/notion-cli/-/notion-cli-0.1.2.tgz"
      sha256 "f36c8ae07b545520c20fe36394ea023541af96c58f975946ce1947d68328f0c8"
      license "MIT"

      depends_on "node"

      def install
        system "npm", "install", *std_npm_args
        bin.install_symlink Dir["#{libexec}/bin/*"]
      end

      test do
        assert_match version.to_s, shell_output("#{bin}/notion --version")
      end
    end
    ```

    **Step 3 — Create README.md** (overwrite the auto-generated one):

    ```markdown
    # homebrew-notion-cli

    Homebrew tap for [notion-cli](https://github.com/andrzejchm/notion-cli) — read Notion pages and databases from the terminal.

    ## Install

    ```bash
    brew tap andrzejchm/notion-cli
    brew install notion-cli
    notion init   # paste your Notion integration token
    ```

    ## Update

    ```bash
    brew upgrade notion-cli
    ```

    ## Usage

    See the [notion-cli README](https://github.com/andrzejchm/notion-cli#readme) for full documentation.
    ```

    **Step 4 — Commit and push:**
    ```bash
    git add Formula/notion-cli.rb README.md
    git commit -m "notion-cli 0.1.2 (new formula)"
    git push origin main
    ```
  </action>
  <verify>
    ```bash
    # Verify the formula file exists and parses correctly
    brew tap andrzejchm/notion-cli /Users/andrzejchm/Developer/homebrew-notion-cli
    brew install --formula andrzejchm/notion-cli/notion-cli
    notion --version   # should print 0.1.2
    ```
    The install should succeed and print the version.
  </verify>
  <done>
    - `Formula/notion-cli.rb` exists with correct sha256 and std_npm_args install
    - `README.md` documents `brew tap andrzejchm/notion-cli && brew install notion-cli`
    - Files pushed to github.com/andrzejchm/homebrew-notion-cli main branch
    - `brew install andrzejchm/notion-cli/notion-cli` installs a working `notion` binary
  </done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 3: Verify brew install works end-to-end</name>
  <what-built>Homebrew formula that installs notion-cli from the npm tarball via brew install.</what-built>
  <how-to-verify>
    Run these commands in a fresh terminal:
    ```bash
    # If you have npm-installed notion, unlink it first:
    # npm uninstall -g @andrzejchm/notion-cli

    brew tap andrzejchm/notion-cli
    brew install notion-cli
    notion --version      # should print 0.1.2
    notion --help         # should show all commands
    ```
    Expected: `notion --version` prints `0.1.2` and `notion --help` shows the command list.
  </how-to-verify>
  <resume-signal>Type "verified" if brew install works, or describe the error</resume-signal>
</task>

</tasks>

<verification>
- `github.com/andrzejchm/homebrew-notion-cli` exists and is public
- `Formula/notion-cli.rb` contains the correct sha256 for v0.1.2
- `brew tap andrzejchm/notion-cli && brew install notion-cli` installs a working binary
- `notion --version` prints `0.1.2`
</verification>

<success_criteria>
User can run `brew tap andrzejchm/notion-cli && brew install notion-cli` and get a fully working `notion` binary without needing npm installed.
</success_criteria>

<output>
After completion, create `.planning/phases/07-homebrew-distribution/07-01-SUMMARY.md`
</output>
