---
phase: 05-agent-distribution
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/agent-skill.md
autonomous: true
requirements:
  - AGNT-01
  - AGNT-02

must_haves:
  truths:
    - "Agent skill file documents all CLI commands with usage, flags, and output format"
    - "Skill file includes setup instructions for Claude Code (CLAUDE.md), OpenCode (.opencode/), and Codex"
    - "Skill file shows working examples of every command in both human (TTY) and agent (piped/JSON) mode"
    - "Common agent patterns are documented (search then read, query then filter, pipe to jq)"
    - "Authentication setup (notion init / NOTION_API_TOKEN env var) is explained clearly"
  artifacts:
    - path: "docs/agent-skill.md"
      provides: "Complete agent skill file covering all commands, setup, and usage patterns"
      contains: "notion init|notion search|notion ls|notion read|notion db schema|notion db query"
  key_links:
    - from: "Claude Code CLAUDE.md or .claude/commands/"
      to: "docs/agent-skill.md"
      via: "Reference in CLAUDE.md: 'See docs/agent-skill.md for notion-cli usage'"
      pattern: "agent-skill"
---

<objective>
Write the agent skill file that teaches AI coding agents (Claude Code, OpenCode, Codex) how to use the Notion CLI effectively.

Purpose: Without a skill file, agents must guess at command syntax, don't know when to use --json vs --md, and miss common patterns like piping to jq. A high-quality skill file is the difference between an agent that uses the CLI correctly the first time and one that fumbles.
Output: docs/agent-skill.md — the complete agent skill reference.
</objective>

<execution_context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</execution_context>

<context>
@.planning/phases/01-foundation-auth/01-04-SUMMARY.md

<interfaces>
<!-- All commands available after Phases 1-4 complete -->

Phase 1 commands:
  notion init                           — set up integration token
  notion profile list/use/remove        — manage auth profiles
  notion completion bash/zsh/fish       — shell completions

Phase 2 commands:
  notion search <query> [--type page|database] [--json]
  notion ls [--json]
  notion open <id/url>
  notion users [--json]
  notion comments <id/url> [--json]
  Global flags: --json (force JSON output), --md (force markdown output)

Phase 3 commands:
  notion read <id/url> [--json]         — outputs markdown by default

Phase 4 commands:
  notion db schema <id/url> [--json]
  notion db query <id/url> [--filter "Prop=Value"] [--sort "Prop:asc"] [--columns "A,B,C"] [--json]
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write docs/agent-skill.md</name>
  <files>docs/agent-skill.md</files>
  <action>
Create `docs/agent-skill.md`. This file is the authoritative reference for AI agents using this CLI.

The file must cover these sections in order:

**1. Overview (3-4 sentences)**
What this CLI does, primary audience (AI agents + developers), core value, and the `notion` command name.

**2. Installation & Setup**
```bash
npm install -g @andrzejchm/notion-cli
notion init   # interactive setup — enter your integration token
```
Also document env var alternative:
```bash
export NOTION_API_TOKEN=ntn_your_token_here
```
Include link to get token: https://www.notion.so/profile/integrations/internal

**3. Agent Setup by Platform**

For Claude Code:
```markdown
Add to CLAUDE.md:
> Use `notion` CLI to access Notion pages and databases.
> Token: ensure NOTION_API_TOKEN is set or run `notion init` once.
> For page content: `notion read <id> | your analysis here`
> For structured data: `notion db query <id> --json | jq '.[] | .properties'`
```

For OpenCode:
```markdown
Add to .opencode/config.json:
{
  "tools": ["bash"],
  "instructions": "notion CLI is available for Notion access. See docs/agent-skill.md."
}
```

For Codex / generic agents:
```markdown
Add to system prompt or AGENTS.md:
> Available tool: `notion` CLI (npm install -g @andrzejchm/notion-cli)
> Auth: NOTION_API_TOKEN env var or run `notion init`
```

**4. Output Modes (critical section)**

```markdown
## Output Modes

The CLI auto-detects context:

| Context | Default Output | Override |
|---------|----------------|----------|
| Terminal (TTY) | Formatted tables, colored | --json for JSON |
| Piped / agent | JSON | --md for markdown |

**For agents: always pipe to get JSON:**
```bash
notion search "my query" | jq '.[]'
notion db query <id> | jq '.[] | .properties.Status'
```

**For page content: markdown is always the default:**
```bash
notion read <id>          # markdown output (works in terminal AND piped)
notion read <id> --json   # raw JSON block tree
```
```

**5. Command Reference**

For each command, show:
- Syntax
- What it does
- Key flags
- Example (TTY + piped version where relevant)

Commands to document:

```bash
# Authentication
notion init
notion profile list
notion profile use <name>
notion profile remove <name>

# Search & Discovery  
notion search <query>
notion search "project docs" --type page
notion search "tracker" --type database
notion ls
notion open <id/url>    # opens in default browser
notion users
notion comments <id/url>

# Page Reading
notion read <id/url>           # markdown output
notion read <id/url> --json    # JSON block tree
notion read <url>              # Notion URLs accepted everywhere

# Database Operations
notion db schema <id/url>
notion db query <id/url>
notion db query <id/url> --filter "Status=Done"
notion db query <id/url> --filter "Priority=High" --filter "Status=In Progress"
notion db query <id/url> --sort "Name:asc"
notion db query <id/url> --sort "Created:desc"
notion db query <id/url> --columns "Title,Status,Assignee"
notion db query <id/url> --json | jq '.[] | {id, title: .properties.Name}'
```

**6. Common Agent Patterns**

```bash
# Pattern 1: Find a page by title, then read it
PAGE_ID=$(notion search "Meeting Notes" --type page | jq -r '.[0].id')
notion read "$PAGE_ID"

# Pattern 2: Get all items with a specific status from a database
notion db query "$DB_ID" --filter "Status=Done" | jq '.[] | .properties'

# Pattern 3: List recent entries sorted by date
notion db query "$DB_ID" --sort "Last edited:desc" --columns "Title,Status" | head -20

# Pattern 4: Read a page and extract specific content
notion read "$PAGE_ID" | grep -A 5 "## Action Items"

# Pattern 5: Check database schema before building a filter
notion db schema "$DB_ID"   # see what properties exist and their valid values
notion db query "$DB_ID" --filter "Status=In Progress"

# Pattern 6: Using URLs instead of IDs
notion read "https://www.notion.so/myworkspace/My-Page-abc123def456"
notion db query "https://www.notion.so/myworkspace/My-DB-abc123def456"
```

**7. ID and URL Formats**

```markdown
The CLI accepts:
- 32-char hex IDs: `abc123def456789012345678901234ab`
- UUID format:     `abc123de-f456-7890-1234-5678901234ab`
- Full Notion URLs: `https://www.notion.so/workspace/Page-Title-abc123def456`

All commands accept any of these formats for the <id> argument.
```

**8. Troubleshooting**

```markdown
**Page not found (404):** The page must be shared with your integration.
In Notion: open the page → ⋯ menu → Add connections → select your integration.

**Unauthorized (401):** Run `notion init` to reconfigure your token.
Get a new token at: https://www.notion.so/profile/integrations/internal

**Search returns no results:** Search is title-only (not full-text content search).
The page must also be shared with your integration.

**Empty database query:** No entries match your filters, or the database has no entries.
Run `notion db schema <id>` to see available properties and their valid values first.
```

**Format requirements:**
- Use GitHub-flavored markdown (GFM)
- Code blocks must have language specifiers (bash, json, markdown)
- Table of contents at the top (link to each section)
- Total file length: 200-350 lines
- Avoid repeating information — each fact appears once
  </action>
  <verify>wc -l docs/agent-skill.md && grep -c "notion " docs/agent-skill.md</verify>
  <done>docs/agent-skill.md exists, 200+ lines, covers all commands (search, ls, open, users, comments, read, db schema, db query), includes setup for Claude Code + OpenCode + Codex, documents output modes, shows common agent patterns</done>
</task>

</tasks>

<verification>
- docs/agent-skill.md exists with 200+ lines
- All commands documented: init, profile, search, ls, open, users, comments, read, db schema, db query
- Output modes section clearly explains TTY vs piped behavior
- Setup instructions for Claude Code, OpenCode, Codex all present
- Common agent patterns section has 4+ working examples
- Troubleshooting section covers the top 4 agent failure modes
</verification>

<success_criteria>
- docs/agent-skill.md is complete, accurate, and 200-350 lines
- AGNT-01: All commands, flags, output formats, and patterns documented
- AGNT-02: Claude Code, OpenCode, and Codex setup instructions included
- A new developer or AI agent could read this file and successfully use every command without reading source code
</success_criteria>

<output>
After completion, create `.planning/phases/05-agent-distribution/05-01-SUMMARY.md`
</output>
