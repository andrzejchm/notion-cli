---
phase: 05-agent-distribution
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - README.md
  - .npmignore
autonomous: true
requirements:
  - DIST-01

must_haves:
  truths:
    - "npm pack --dry-run succeeds and the tarball includes dist/, docs/agent-skill.md, README.md, and package.json"
    - "package.json has correct name (@andrzejchm/notion-cli), description, keywords, repository, engines (node >=22), and files array"
    - "package.json bin field maps 'notion' to './dist/cli.js'"
    - "README.md has installation instructions (npm install -g) and a quick-start section"
    - ".npmignore excludes src/, tests/, .planning/, tsconfig.json, and other dev-only files"
    - "The packed tarball is under 1MB"
  artifacts:
    - path: "package.json"
      provides: "Complete npm publish metadata with correct bin, files, engines, repository fields"
      contains: "\"name\": \"@andrzejchm/notion-cli\""
    - path: "README.md"
      provides: "Package README with install, setup, and quick-start"
      contains: "npm install -g @andrzejchm/notion-cli"
    - path: ".npmignore"
      provides: "Excludes dev files from npm package"
      contains: "src/"
  key_links:
    - from: "npm install -g @andrzejchm/notion-cli"
      to: "package.json bin.notion"
      via: "npm links ./dist/cli.js to notion in PATH"
      pattern: "\"notion\""
---

<objective>
Prepare the npm package for publishing: audit package.json metadata, write README.md, and create .npmignore to produce a clean, correctly sized tarball.

Purpose: A correctly configured package is the difference between `npm install -g @andrzejchm/notion-cli` working and failing. Most publish failures are metadata and file inclusion mistakes. This plan fixes them before publishing.
Output: Updated package.json, README.md, and .npmignore — verified with npm pack --dry-run.
</objective>

<execution_context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</execution_context>

<context>
@.planning/phases/01-foundation-auth/01-04-SUMMARY.md

<interfaces>
<!-- Current package.json state -->
Current package.json (read from file before editing):
```json
{
  "name": "@andrzejchm/notion-cli",
  "version": "0.1.0",
  "type": "module",
  "bin": { "notion": "./dist/cli.js" },
  "scripts": {
    "build": "tsup",
    "dev": "tsup --watch",
    "test": "vitest run",
    "test:watch": "vitest"
  },
  "dependencies": { ... },
  "devDependencies": { ... }
}
```

<!-- Current tsup.config.ts -->
```typescript
// entry: ['src/cli.ts'], format: ['esm'], target: 'node22'
// Output goes to dist/cli.js with #!/usr/bin/env node shebang banner
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Finalize package.json publish metadata</name>
  <files>package.json</files>
  <action>
Read the current package.json and add/update these fields:

```json
{
  "name": "@andrzejchm/notion-cli",
  "version": "0.1.0",
  "description": "Read Notion pages and databases from the terminal. Built for AI agents and developers.",
  "keywords": ["notion", "cli", "notion-api", "ai-agent", "markdown", "database"],
  "author": "Andrzej Chm",
  "license": "MIT",
  "homepage": "https://github.com/andrzejchm/notion-cli#readme",
  "repository": {
    "type": "git",
    "url": "https://github.com/andrzejchm/notion-cli.git"
  },
  "bugs": {
    "url": "https://github.com/andrzejchm/notion-cli/issues"
  },
  "engines": {
    "node": ">=22.0.0"
  },
  "files": [
    "dist/",
    "docs/agent-skill.md",
    "README.md"
  ]
}
```

**Important:** Keep all existing fields (type, bin, scripts, dependencies, devDependencies). Only ADD the new fields above. Do NOT remove existing content.

The `"files"` field controls what goes into the npm tarball:
- `dist/` — the compiled CLI binary
- `docs/agent-skill.md` — agent skill reference
- `README.md` — npm package page content

npm always includes `package.json` and `README.md` by default; the `files` field is additive.
  </action>
  <verify>node -e "const p = JSON.parse(require('fs').readFileSync('package.json','utf8')); console.log(p.engines, p.files, p.repository?.type)"</verify>
  <done>package.json has description, keywords, author, license, engines (node >=22), files array, and repository fields. All existing fields preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Write README.md and .npmignore</name>
  <files>README.md, .npmignore</files>
  <action>
**README.md** — The npm package page and GitHub repo README. Must be scannable in 30 seconds:

```markdown
# notion-cli

Read Notion pages and databases from the terminal. Built for AI coding agents and developers.

```bash
npm install -g @andrzejchm/notion-cli
notion init   # enter your Notion integration token
```

## What it does

- `notion search` — find pages and databases by title
- `notion read <id>` — read any page as full-fidelity markdown  
- `notion db query <id>` — query database entries with filtering and sorting
- Dual output: formatted tables in terminal, JSON when piped (agent-friendly)

## Quick Start

1. Create a Notion integration at https://www.notion.so/profile/integrations/internal
2. Share your pages/databases with the integration (⋯ → Add connections)
3. Run `notion init` and enter your token

```bash
# Find a page
notion search "meeting notes"

# Read it as markdown
notion read https://www.notion.so/workspace/Meeting-Notes-abc123

# Query a database
notion db query abc123def456 --filter "Status=Done" --json | jq '.[] | .properties'
```

## Agent Usage

For AI agents, pipe commands to get JSON output:

```bash
notion search "my project" | jq '.[0].id'
notion db query "$DB_ID" | jq '.[] | .properties.Title'
notion read "$PAGE_ID"   # markdown output works in agents too
```

See [`docs/agent-skill.md`](docs/agent-skill.md) for the complete agent skill reference including Claude Code, OpenCode, and Codex setup instructions.

## Commands

| Command | Description |
|---------|-------------|
| `notion init` | Set up Notion integration token |
| `notion search <query>` | Search pages and databases by title |
| `notion ls` | List all accessible pages and databases |
| `notion open <id>` | Open a page in the browser |
| `notion read <id>` | Read a page as markdown |
| `notion db schema <id>` | Show database property schema |
| `notion db query <id>` | Query database entries |
| `notion users` | List workspace members |
| `notion comments <id>` | Read page comments |

## Authentication

```bash
# Option 1: interactive setup (recommended)
notion init

# Option 2: environment variable
export NOTION_API_TOKEN=ntn_your_token_here
```

Token format: starts with `ntn_` (new) or `secret_` (legacy).
Get your token at: https://www.notion.so/profile/integrations/internal

## License

MIT
```

**Note:** Write exactly this README. Do not add extra sections or modify the structure.

---

**.npmignore** — Files to exclude from the published package:

```
# Source files (not needed in package)
src/
tests/
*.test.ts

# Config files
tsconfig.json
tsup.config.ts
vitest.config.ts
.eslintrc*
.prettierrc*

# Planning and development docs
.planning/
.opencode/
.agents/
CLAUDE.md

# Build artifacts we don't want published
*.tsbuildinfo
*.map

# Environment
.env
.env.*
```

Write this exact content to `.npmignore`.
  </action>
  <verify>npm pack --dry-run 2>&1 | grep -E "^npm notice|Tarball Contents|total files" | head -20</verify>
  <done>npm pack --dry-run shows dist/ and docs/agent-skill.md in tarball contents. Tarball is under 1MB. README.md and .npmignore exist.</done>
</task>

</tasks>

<verification>
- `npm pack --dry-run` succeeds
- Tarball includes: dist/cli.js, docs/agent-skill.md, README.md, package.json
- Tarball excludes: src/, tests/, .planning/, tsconfig.json, tsup.config.ts
- package.json has engines.node >= 22, files array, description, keywords, repository
- README.md has installation instructions and quick-start examples
</verification>

<success_criteria>
- npm pack --dry-run completes without errors
- Tarball size under 1MB
- All required files included (dist/, docs/agent-skill.md, README.md)
- All dev files excluded (src/, tests/, .planning/, tsconfig files)
- package.json publish metadata complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-agent-distribution/05-02-SUMMARY.md`
</output>
