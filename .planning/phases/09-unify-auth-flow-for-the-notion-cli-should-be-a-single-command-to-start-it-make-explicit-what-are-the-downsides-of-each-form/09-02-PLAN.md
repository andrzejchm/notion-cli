---
phase: 09-unify-auth-flow-for-the-notion-cli-should-be-a-single-command-to-start-it-make-explicit-what-are-the-downsides-of-each-form
plan: "02"
type: execute
wave: 2
depends_on:
  - "09-01"
files_modified:
  - README.md
  - docs/README.agents.md
  - docs/skills/using-notion-cli/SKILL.md
autonomous: true
requirements:
  - AUTH-UX-04
  - AUTH-UX-05

must_haves:
  truths:
    - "README Authentication section leads with `notion auth` as the canonical first step"
    - "README includes a tradeoff comparison table (OAuth vs integration token) with upsides and downsides of each"
    - "SKILL.md Setup section uses `notion auth` as the primary setup command"
    - "docs/README.agents.md auth section references `notion auth` as the entry point"
    - "`notion init` is still mentioned as a backward-compatible direct shortcut in docs (not removed)"
  artifacts:
    - path: "README.md"
      provides: "Updated Authentication section with notion auth as primary entry point and tradeoff table"
      contains: "notion auth"
    - path: "docs/skills/using-notion-cli/SKILL.md"
      provides: "Updated Setup section using notion auth"
      contains: "notion auth"
    - path: "docs/README.agents.md"
      provides: "Updated auth section referencing notion auth"
      contains: "notion auth"
  key_links:
    - from: "README.md"
      to: "notion auth command"
      via: "code block in Authentication section"
      pattern: "notion auth"
    - from: "docs/skills/using-notion-cli/SKILL.md"
      to: "notion auth command"
      via: "Setup section code block"
      pattern: "notion auth"
---

<objective>
Update README.md, docs/README.agents.md, and docs/skills/using-notion-cli/SKILL.md so that `notion auth` is the canonical authentication entry point users and agents are directed to first, with a clear tradeoff table explaining the two auth methods.

Purpose: First-time users reading the README or agents reading the SKILL.md should see a single starting command (`notion auth`) that guides them to the right auth method. The existing two-section structure (one for init, one for auth login) is replaced with one unified flow entry + a tradeoff reference table.

Output: Updated README.md, docs/README.agents.md, docs/skills/using-notion-cli/SKILL.md.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/09-unify-auth-flow-for-the-notion-cli-should-be-a-single-command-to-start-it-make-explicit-what-are-the-downsides-of-each-form/09-RESEARCH.md
@.planning/phases/09-unify-auth-flow-for-the-notion-cli-should-be-a-single-command-to-start-it-make-explicit-what-are-the-downsides-of-each-form/09-01-SUMMARY.md

<interfaces>
<!-- Current state of auth sections in each file (executor should read files before editing) -->

README.md — current auth flow (line ~18):
  Line 18: `notion init   # paste your Notion integration token once`
  Lines 124-157: Two separate sections "Internal integration token" and "OAuth user login"
  The section currently leads with `notion init`

docs/skills/using-notion-cli/SKILL.md — current setup (line ~8-13):
  Line 8: `## Setup`
  Line 13: `notion init   # enter your Notion integration token`
  Lines 34-53: Two separate sections for each auth method

docs/README.agents.md — auth references similar pattern to README

Tradeoff table content to use (from RESEARCH.md):

| Method | Upsides | Downsides |
|--------|---------|-----------|
| OAuth user login | Write ops attributed to your Notion account; accesses all pages you can see | Requires browser; tokens expire hourly (auto-refreshed); less suitable for fully automated agents |
| Integration token | Works in CI/headless/agents; no expiry; no browser needed | Write ops attributed to integration bot; must manually connect integration to each page |
| `NOTION_API_TOKEN` env var | Overrides everything; ideal for CI/Docker | Transient; no profile management; same bot-attribution as integration token |
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README.md authentication section to lead with `notion auth`</name>
  <files>README.md</files>
  <action>
Read README.md first. Then make the following targeted changes:

1. **Quick start line (near top, line ~18):** Replace:
   ```
   notion init   # paste your Notion integration token once
   ```
   With:
   ```
   notion auth   # choose your auth method with guided prompts
   ```

2. **Authentication section (around line 124):** Replace the two-section structure ("Internal integration token" and "OAuth user login (recommended for write operations)") with a unified structure:

   ```markdown
   ## Authentication

   Two authentication methods are available. Start with the interactive setup to choose:

   ```sh
   notion auth   # interactive selector — choose OAuth or integration token
   ```

   `notion init` is also available as a direct shortcut (backward compatible).

   ### Tradeoff comparison

   | Method | Best for | Write attribution | Requires |
   |--------|----------|-------------------|----------|
   | **OAuth user login** | Write-heavy workflows, personal use | Your Notion account | Browser (or `--manual` for headless) |
   | **Integration token** | CI, Docker, automated agents | Integration bot | Token from notion.so/profile/integrations |
   | `NOTION_API_TOKEN` env var | CI/Docker without config files | Integration bot | Token set in environment |

   **Priority:** `NOTION_API_TOKEN` env var → OAuth token → integration token (highest wins)

   ### OAuth user login

   ```sh
   notion auth               # interactive — select "OAuth user login"
   # or directly:
   notion auth login         # opens browser OAuth flow
   notion auth login --manual  # headless: prints URL, prompts to paste redirect
   notion auth status        # shows current auth state
   notion auth logout        # removes OAuth session
   ```

   Comments and pages are attributed to your **actual Notion account**.
   Access tokens expire after ~1 hour and are refreshed automatically.

   ### Internal integration token

   ```sh
   notion auth               # interactive — select "Internal integration token"
   # or directly:
   notion init               # guided token setup (backward compatible)
   ```

   Works everywhere (CI, headless, agents). Write operations are attributed to the **integration bot**.
   You must manually connect the integration to each page (`⋯` → Add connections).

   ### Profile management

   ```sh
   notion profile list       # list all profiles
   notion profile use <name> # switch active profile
   notion profile remove <name>
   ```
   ```

   Keep the rest of the README (profile management, commands table, etc.) intact.

3. In the command table (around line 83), update the `notion init` row description if it says "Set up your Notion integration token" — change to:
   ```
   | `notion init` | Set up integration token directly (shortcut, backward compatible) |
   ```
   And add a row for `notion auth` if not present:
   ```
   | `notion auth` | Interactive auth setup — choose OAuth or integration token |
   ```
  </action>
  <verify>
    <automated>grep -n "notion auth" /Users/andrzejchm/Developer/notion-cli/README.md | head -20</automated>
  </verify>
  <done>README.md contains `notion auth` in at least the quick start section, the auth section header, and the tradeoff table. `notion init` still appears as a backward-compatible shortcut (not removed).</done>
</task>

<task type="auto">
  <name>Task 2: Update SKILL.md and docs/README.agents.md to use `notion auth` as primary setup command</name>
  <files>docs/skills/using-notion-cli/SKILL.md, docs/README.agents.md</files>
  <action>
Read both files first, then make targeted changes:

**docs/skills/using-notion-cli/SKILL.md:**

1. **Setup section (line ~8-13):** Replace:
   ```
   notion init   # enter your Notion integration token
   ```
   With:
   ```
   notion auth   # interactive setup — choose OAuth (user-attributed) or integration token (bot-attributed)
   # or directly: notion auth login | notion init
   ```

2. **Auth section (lines ~34-53):** Replace the two separate subsections with a unified reference:
   ```markdown
   ### Authentication

   Two methods available. If both configured, OAuth takes precedence.

   | Method | Command | Attribution | Notes |
   |--------|---------|-------------|-------|
   | Interactive setup | `notion auth` | — | Guides you to choose; TTY required |
   | OAuth user login | `notion auth login [--profile <name>] [--manual]` | Your Notion account | Browser required; `--manual` for headless |
   | Integration token | `notion init` | Integration bot | Works in CI/headless; must connect integration to pages |

   ```sh
   notion auth               # unified interactive entry point
   notion auth login         # OAuth browser flow directly
   notion auth login --manual  # headless OAuth
   notion auth status        # show current auth state
   notion auth logout        # remove OAuth session
   notion init               # integration token setup (direct shortcut)
   ```

   **Headless/CI agents:** Use `NOTION_API_TOKEN=<token>` env var — overrides all config, no TTY needed.
   ```

3. **Error troubleshooting line (~176):** Replace `notion init` references in the 401 error section:
   - Change `**401 / unauthorized** — Run \`notion init\` or set \`NOTION_API_TOKEN\`.`
   - To: `**401 / unauthorized** — Run \`notion auth\` (interactive) or set \`NOTION_API_TOKEN\`.`

4. **`notion init` fails in agent troubleshooting line (~182):** Update to:
   - `**\`notion auth\` requires TTY** — Use \`NOTION_API_TOKEN\` env var in agents, or use \`notion auth login --manual\`.`

**docs/README.agents.md:**

Read the file, locate the auth section. Apply the same pattern:
- Lead with `notion auth` as the entry point
- Keep `notion init` as a backward-compatible mention
- Add a brief tradeoff note (1-2 sentences, not a full table — agents.md is a quick reference)
  </action>
  <verify>
    <automated>grep -n "notion auth" /Users/andrzejchm/Developer/notion-cli/docs/skills/using-notion-cli/SKILL.md | head -15 && grep -n "notion auth" /Users/andrzejchm/Developer/notion-cli/docs/README.agents.md | head -10</automated>
  </verify>
  <done>Both SKILL.md and docs/README.agents.md contain `notion auth` as the primary setup command. `notion init` still appears as a direct shortcut. SKILL.md auth table shows both methods side by side.</done>
</task>

</tasks>

<verification>
- `grep -n "notion auth" README.md` shows results in quick start, auth section, and tradeoff table
- `grep -n "notion auth" docs/skills/using-notion-cli/SKILL.md` shows results in Setup and auth sections
- `grep -n "notion auth" docs/README.agents.md` shows at least one result in auth section
- `grep -n "notion init" README.md` shows `notion init` still present as backward-compat shortcut
- `grep -n "notion init" docs/skills/using-notion-cli/SKILL.md` shows `notion init` still present
- `npm run build` still passes (docs-only changes, build should be unaffected)
</verification>

<success_criteria>
- README.md quick-start uses `notion auth` instead of `notion init`
- README.md has a tradeoff comparison table with both methods
- SKILL.md Setup section uses `notion auth` as the primary command
- SKILL.md has a unified auth table instead of two separate subsections
- docs/README.agents.md references `notion auth` as the entry point
- `notion init` remains documented as a backward-compatible shortcut in all three files
- Build still passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-unify-auth-flow-for-the-notion-cli-should-be-a-single-command-to-start-it-make-explicit-what-are-the-downsides-of-each-form/09-02-SUMMARY.md`
</output>
